(function (k) {
	function d(a) {
		return a.replace(/[\.\-]/g, "")
	}

	function b(i) {
		rutAndDv = j(i);
		var a = rutAndDv[0];
		var l = rutAndDv[1];
		if (!(a && l)) {
			return a || i
		}
		var f = "";
		while (a.length > 3) {
			f = "." + a.substr(a.length - 3) + f;
			a = a.substring(0, a.length - 3)
		}
		return a + f + "-" + l
	}

	function h(a) {
		return a.type && a.type.match(/^key(up|down|press)/) && (a.keyCode == 8 || a.keyCode == 16 || a.keyCode == 17 || a.keyCode == 18 || a.keyCode == 20 || a.keyCode == 27 || a.keyCode == 37 || a.keyCode == 38 || a.keyCode == 39 || a.keyCode == 40 || a.keyCode == 91)
	}

	function v(n) {
		if (typeof n !== "string") {
			return false
		}
		var f = d(n);
		if (f.length < 2) {
			return false
		}
		var l = f.charAt(f.length - 1).toUpperCase();
		var a = parseInt(f.substr(0, f.length - 1));
		if (a === NaN) {
			return false
		}
		return c(a).toString().toUpperCase() === l
	}

	function c(i) {
		var a = 0;
		var l = 2;
		if (typeof i !== "number") {
			return
		}
		i = i.toString();
		for (var f = i.length - 1; f >= 0; f--) {
			a = a + i.charAt(f) * l;
			l = (l + 1) % 8 || 2
		}
		switch (a % 11) {
			case 1:
				return "k";
			case 0:
				return 0;
			default:
				return 11 - a % 11
		}
	}

	function p(f, a) {
		f.val(b(f.val()))
	}

	function m(f, a) {
		if (v(f.val())) {
			f.trigger("rutValido", j(f.val()))
		} else {
			f.trigger("rutInvalido")
		}
	}

	function j(n) {
		var f = d(n);
		if (f.length == 0) {
			return [null, null]
		}
		if (f.length == 1) {
			return [f, null]
		}
		var l = f.charAt(f.length - 1);
		var a = f.substring(0, f.length - 1);
		return [a, l]
	}

	var q = {validateOn: "blur", formatOn: "blur", ignoreControlKeys: true};
	var g = {
		init: function (f) {
			if (this.length > 1) {
				for (var e = 0; e < this.length; e++) {
					console.log(this[e]);
					k(this[e]).rut(f)
				}
			} else {
				var a = this;
				a.opts = k.extend({}, q, f);
				a.opts.formatOn && a.on(a.opts.formatOn, function (i) {
					if (a.opts.ignoreControlKeys && h(i)) {
						return
					}
					p(a, i)
				});
				a.opts.validateOn && a.on(a.opts.validateOn, function (i) {
					m(a, i)
				})
			}
			return this
		}
	};
	k.fn.rut = function (a) {
		if (g[a]) {
			return g[a].apply(this, Array.prototype.slice.call(arguments, 1))
		} else {
			if (typeof a === "object" || !a) {
				return g.init.apply(this, arguments)
			} else {
				k.error("El mÃ©todo " + a + " no existe en jQuery.rut")
			}
		}
	};
	k.formatRut = function (a) {
		return b(a)
	};
	k.validateRut = function (a, f) {
		if (v(a)) {
			var e = j(a);
			k.isFunction(f) && f(e[0], e[1]);
			return true
		} else {
			return false
		}
	}
})(jQuery);